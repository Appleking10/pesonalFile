<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="shortcut icon" href="../../img/favicon.ico" />

    <link rel="stylesheet" href="./css/animate.css">
    <link rel="stylesheet" href="../../icomoon/style.css">
    <link rel="stylesheet" href="../../css/coolmenu.css">
    <title>阿庞的照片墙</title>
    <style>
        html,
        body {
            height: 100%;
        }

        body {
            background-color: rgba(214, 114, 83, 0.6);
            margin: 0;
            font-family: Helvetica, sans-serif;
            ;
            overflow: hidden;
        }

        a {
            color: #ffffff;
        }

        #info {
            position: absolute;
            width: 100%;
            color: #ffffff;
            padding: 5px;
            font-family: Monospace;
            font-size: 13px;
            font-weight: bold;
            text-align: center;
            z-index: 1;
        }



        #menu {
            position: absolute;
            bottom: 20px;
            width: calc(100% - 70px);
            text-align: center;
        }

        .element {
            width: 120px;
            height: 120px;
            box-shadow: 0px 0px 12px rgba(22, 56, 66, 0.81);
            border: 1px solid rgba(127, 255, 255, 0.25);
            text-align: center;
            cursor: default;
        }

        .element:hover {
            box-shadow: 0px 0px 12px rgba(0, 255, 255, 0.75);
            border: 1px solid rgba(127, 255, 255, 0.75);
        }

        button {
            color: rgba(255, 255, 255, 0.75);
            background: transparent;
            border: 3px solid #f3d3b9;
            /* box-shadow: 0 0 9px 2px #f3d3b9, 0 0 9px 2px #f3d3b9 inset; */
            /* border: 0px; */
            padding: 5px 10px;
            cursor: pointer;
        }

        button:hover {
            background-color: rgba(0, 255, 255, 0.5);
        }

        button:active {
            color: #000000;
            background-color: rgba(255, 255, 255, 0.75);
        }

        .popWin {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            position: relative;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: all 0.5s;
            background-color: rgba(0, 0, 0, 0.3);
            z-index: 2;
        }

        .content-wrap {
            width: 100%;
            height: 500px;
            margin-bottom: 30px;
            text-align: center;
            line-height: 500px;
            background: ghostwhite;
        }

        .closeBtn {
            height: 30px;
            width: 200px;
            border-radius: 20px;
            line-height: 30px;
            background: cornflowerblue;
            color: navajowhite;
            text-align: center;
        }

        #outmenu {
            position: absolute;
            /* width: 150px; */
            /* height: 150px; */
            bottom: 30px;
            right: 10px;
            z-index: 10;
            border: none;
        }

        @media screen and (max-width:320px) {
            #menu {
                width: 100%;
            }
        }
    </style>
</head>

<body>
    <script src="../../js/jquery-2.1.1.min.js"></script>

    <script src="js/three.min.js"></script>
    <script src="js/tween.min.js"></script>
    <script src="js/TrackballControls.js"></script>
    <script src="js/CSS3DRenderer.js"></script>


    <div id="container"></div>
    <div id="menu">
        <button id="table">PY ❤</button>
        <button id="sphere">滚球球</button>
        <button id="helix">799</button>
        <button id="grid">我方了</button>
    </div>
    <div class="popWin bounceIn" id="popWin">
        <div class="content-wrap">这是放照片/视频的地方</div>
        <div class="closeBtn" id="closeBtn">返回</div>
    </div>
    <div class="mobile-canvas" id="mobile-canvas">
        <div class="button-container">
            <div class="button-wrapper">
                <div class="button">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <div class="button-child-wrapper">
                    <div class="button-child icon-pictures" id="gotophoto">

                    </div>
                    <div class="button-child icon-lab" id="gotoTest">

                    </div>
                    <div class="button-child icon-checkered-flag" id="gotoGame">
                    </div>
                </div>
            </div>
        </div>
        <div class="overlay"></div>
    </div>
    <script>
        var table = [];
        var rander = []

        for (var j = 1; j < 64; j++) {
            // rander = randomNum(1, 64, table);
            rander.push(j)
            // table.push("../../img2/" + rander + ".jpg");
        }
        table = getArrayItems(rander, 40)
        console.log(table)
        var camera, scene, renderer;
        var controls;

        var objects = [];
        var targets = {
            table: [],
            sphere: [],
            helix: [],
            grid: []
        };

        init();
        animate();

        //随机范围取不重复值
        function getArrayItems(arr, num) {
            //新建一个数组,将传入的数组复制过来,用于运算,而不要直接操作传入的数组;
            var temp_array = new Array();
            for (var index in arr) {
                temp_array.push(arr[index]);
            }
            //取出的数值项,保存在此数组
            var return_array = new Array();
            for (var i = 0; i < num; i++) {
                //判断如果数组还有可以取出的元素,以防下标越界
                if (temp_array.length > 0) {
                    //在数组中产生一个随机索引
                    var arrIndex = Math.floor(Math.random() * temp_array.length);
                    //将此随机索引的对应的数组元素值复制出来
                    return_array[i] = "../../img2/" + temp_array[arrIndex] + ".jpg";
                    //然后删掉此索引的数组元素,这时候temp_array变为新的数组
                    temp_array.splice(arrIndex, 1);
                } else {
                    //数组中数据项取完后,退出循环,比如数组本来只有10项,但要求取出20项.
                    break;
                }
            }
            return return_array;
        }

        function init() {

            camera = new THREE.PerspectiveCamera(40, window.innerWidth / window.innerHeight, 1, 10000);
            camera.position.z = 3500;

            scene = new THREE.Scene();
            // table
            var xytup = [{
                x: -480,
                y: 720
            }, {
                x: -480,
                y: 590
            }, {
                x: -480,
                y: 460
            }, {
                x: -480,
                y: 330
            }, {
                x: -480,
                y: 200
            }, {
                x: -480,
                y: 70
            }, {
                x: -480,
                y: -60
            }, {
                x: -480,
                y: -190
            }, {
                x: -350,
                y: 720
            }, {
                x: -220,
                y: 708
            }, {
                x: -90,
                y: 684
            }, {
                x: -45,
                y: 554
            }, {
                x: -90,
                y: 424
            }, {
                x: -220,
                y: 360
            }, {
                x: -350,
                y: 336
            }, {
                x: 120,
                y: 720
            }, {
                x: 180,
                y: 600
            }, {
                x: 240,
                y: 480
            }, {
                x: 360,
                y: 360
            }, {
                x: 480,
                y: 480
            }, {
                x: 540,
                y: 600
            }, {
                x: 600,
                y: 720
            }, {
                x: 360,
                y: 240
            }, {
                x: 360,
                y: 120
            }, {
                x: 360,
                y: 0
            }, {
                x: 360,
                y: -120
            }, {
                x: 0,
                y: -480
            }, {
                x: -120,
                y: -360
            }, {
                x: 120,
                y: -360
            }, {
                x: 240,
                y: -300
            }, {
                x: -240,
                y: -300
            }, {
                x: -360,
                y: -360
            }, {
                x: 360,
                y: -360
            }, {
                x: -360,
                y: -480
            }, {
                x: 360,
                y: -480
            }, {
                x: -240,
                y: -600
            }, {
                x: 240,
                y: -600
            }, {
                x: 120,
                y: -720
            }, {
                x: -120,
                y: -720
            }, {
                x: 0,
                y: -840
            }]
            for (var i = 0; i < table.length; i++) {

                var element = document.createElement('div');
                element.className = 'element';
                element.style.background = 'url(' + table[i] + ')';
                element.style.backgroundSize = "100%"

                var object = new THREE.CSS3DObject(element);
                object.position.x = Math.random() * 4000 - 2000;
                object.position.y = Math.random() * 4000 - 2000;
                object.position.z = Math.random() * 4000 - 2000;

                element.addEventListener('click', elClick.bind(this, element, i))

                scene.add(object);

                objects.push(object);
                var object = new THREE.Object3D();
                if (xytup[i]) {
                    object.position.x = xytup[i].x;
                    object.position.y = xytup[i].y
                }

                targets.table.push(object);

            }

            // sphere

            var vector = new THREE.Vector3();

            for (var i = 0, l = objects.length; i < l; i++) {

                var phi = Math.acos(-1 + (2 * i) / l);
                var theta = Math.sqrt(l * Math.PI) * phi;

                var object = new THREE.Object3D();

                object.position.x = 800 * Math.cos(theta) * Math.sin(phi);
                object.position.y = 800 * Math.sin(theta) * Math.sin(phi);
                object.position.z = 800 * Math.cos(phi);

                vector.copy(object.position).multiplyScalar(2);

                object.lookAt(vector);

                targets.sphere.push(object);

            }

            // helix

            var vector = new THREE.Vector3();
            var xy799 = [{
                    x: 480,
                    y: 1000
                }, {
                    x: 480,
                    y: 880
                }, {
                    x: 480,
                    y: 760
                }, {
                    x: 480,
                    y: 640
                }, {
                    x: 480,
                    y: 520
                }, {
                    x: 360,
                    y: 520
                }, {
                    x: 240,
                    y: 520
                }, {
                    x: 120,
                    y: 520
                }, {
                    x: 0,
                    y: 520
                }, {
                    x: -120,
                    y: 520
                },
                {
                    x: -240,
                    y: 520
                }, {
                    x: -360,
                    y: 520
                }, {
                    x: 480,
                    y: 300
                },
                {
                    x: 480,
                    y: 180
                },
                {
                    x: 480,
                    y: 60
                },
                {
                    x: 480,
                    y: -60
                },
                {
                    x: 480,
                    y: -180
                },
                {
                    x: 360,
                    y: -180
                },
                {
                    x: 240,
                    y: -180
                },
                {
                    x: 120,
                    y: -180
                },
                {
                    x: 0,
                    y: -180
                },
                {
                    x: -120,
                    y: -180
                },
                {
                    x: -240,
                    y: -180
                },
                {
                    x: -360,
                    y: -180
                },
                {
                    x: 480,
                    y: -400
                },
                {
                    x: 480,
                    y: -520
                },
                {
                    x: 480,
                    y: -640
                },
                {
                    x: 480,
                    y: -760
                },
                {
                    x: 360,
                    y: -400
                },
                {
                    x: 240,
                    y: -400
                },
                {
                    x: 120,
                    y: -400
                },
                {
                    x: 360,
                    y: -760
                },
                {
                    x: 240,
                    y: -760
                },
                {
                    x: 120,
                    y: -760
                },
                {
                    x: 120,
                    y: -640
                },
                {
                    x: 120,
                    y: -520
                },
                {
                    x: 0,
                    y: -760
                },
                {
                    x: -120,
                    y: -760
                },
                {
                    x: -240,
                    y: -760
                },
                {
                    x: -360,
                    y: -760
                },

            ]
            for (var i = 0, l = objects.length; i < l; i++) {

                // var phi = i * 0.175 + Math.PI;

                var object = new THREE.Object3D();

                // object.position.x = 900 * Math.sin(phi);
                // object.position.y = -(i * 8) + 450;
                // object.position.z = 900 * Math.cos(phi);
                object.position.x = xy799[i].x;
                object.position.y = xy799[i].y;
                object.position.z = 0;
                // vector.x = object.position.x * 2;
                // vector.y = object.position.y;
                // vector.z = object.position.z * 2;

                // object.lookAt(vector);

                targets.helix.push(object);

            }

            // grid

            for (var i = 0; i < objects.length; i++) {

                var object = new THREE.Object3D();

                object.position.x = ((i % 4) * 400) - 800;
                object.position.y = (-(Math.floor(i / 4) % 4) * 400) + 800;
                object.position.z = (Math.floor(i / 16)) * 1000 - 2000;

                targets.grid.push(object);

            }

            //

            renderer = new THREE.CSS3DRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.domElement.style.position = 'absolute';
            document.getElementById('container').appendChild(renderer.domElement);

            //

            controls = new THREE.TrackballControls(camera, renderer.domElement);
            controls.rotateSpeed = 0.5;
            controls.minDistance = 500;
            controls.maxDistance = 6000;
            controls.addEventListener('change', render);

            var button = document.getElementById('table');
            button.addEventListener('click', function (event) {

                transform(targets.table, 2000);

            }, false);

            var button = document.getElementById('sphere');
            button.addEventListener('click', function (event) {

                transform(targets.sphere, 2000);

            }, false);

            var button = document.getElementById('helix');
            button.addEventListener('click', function (event) {

                transform(targets.helix, 2000);

            }, false);

            var button = document.getElementById('grid');
            button.addEventListener('click', function (event) {

                transform(targets.grid, 2000);

            }, false);

            transform(targets.table, 5000);

            //

            window.addEventListener('resize', onWindowResize, false);

        }

        function elClick(el, index) {
            // console.log(el.style.backgroundImage)
            var popWinDom = document.getElementById("popWin");
            popWinDom.classList.remove("zoomOut")
            popWinDom.classList.add("bounceIn");

            popWinDom.style.display = "flex";
            var closeBtn = document.getElementById("closeBtn");
            closeBtn.addEventListener('click', function () {
                popWinDom.classList.remove("bounceIn")
                popWinDom.classList.add("zoomOut")
                popWinDom.style.display = "none";

            })

        }

        function transform(targets, duration) {

            TWEEN.removeAll();

            for (var i = 0; i < objects.length; i++) {

                var object = objects[i];
                var target = targets[i];

                new TWEEN.Tween(object.position)
                    .to({
                        x: target.position.x,
                        y: target.position.y,
                        z: target.position.z
                    }, Math.random() * duration + duration)
                    .easing(TWEEN.Easing.Exponential.InOut)
                    .start();

                new TWEEN.Tween(object.rotation)
                    .to({
                        x: target.rotation.x,
                        y: target.rotation.y,
                        z: target.rotation.z
                    }, Math.random() * duration + duration)
                    .easing(TWEEN.Easing.Exponential.InOut)
                    .start();

            }

            new TWEEN.Tween(this)
                .to({}, duration * 2)
                .onUpdate(render)
                .start();

        }

        function onWindowResize() {

            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            renderer.setSize(window.innerWidth, window.innerHeight);

            render();

        }

        function animate() {

            requestAnimationFrame(animate);

            TWEEN.update();

            controls.update();

        }

        function render() {

            renderer.render(scene, camera);

        }
    </script>
    <script>
        $(function () {
            var buttonContainer = document.querySelector('.button-container');
            var overlay = document.querySelector('.overlay');
            var mobileCanvas = document.querySelector('.mobile-canvas')

            mobileCanvas.style.display = 'block'
            buttonContainer.addEventListener('click', function () {
                buttonContainer.classList.toggle('open');
                mobileCanvas.classList.toggle('open');

            }, false);
            document.getElementById("gotophoto").addEventListener('click', function () {
                window.location.href = "#"
            })
            document.getElementById("gotoTest").addEventListener('click', function () {
                window.location.href = '../../test/index.html'
            })
            document.getElementById("gotoGame").addEventListener('click', function () {
                window.location.href = '../../game/index.html'
            })
        });
    </script>
</body>

</html>